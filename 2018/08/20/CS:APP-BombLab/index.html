<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">











  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.2.0" color="#222">






<link rel="stylesheet" href="/css/main.css?v=7.2.0">






<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">








<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    search: {
      root: '/',
      path: ''
    },
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    }
  };
</script>

  <meta name="description" content="BoomLab这个实验非常有意思，需要利用csapp里面第三章学到的x86-64汇编知识以及一些逆向的技巧，来破解程序的的意图，输入正确的指令。 实验目标对于给出的一个二进制文件，寻找正确的输入，当输入错误的时候，会提示“Boom!”意味着拆弹失败，二进制炸弹爆炸。实验总共有6个普通关卡和一个附加关卡,也就是说，总共需要破解7个输入。 前置内容材料准备下载并阅读实验指导书下载并解压缩实验材料部署g">
<meta name="keywords" content="csapp,工程向,计算机体系">
<meta property="og:type" content="article">
<meta property="og:title" content="CS:APP BombLab">
<meta property="og:url" content="lengyu.me/2018/08/20/CS:APP-BombLab/index.html">
<meta property="og:site_name" content="Yu">
<meta property="og:description" content="BoomLab这个实验非常有意思，需要利用csapp里面第三章学到的x86-64汇编知识以及一些逆向的技巧，来破解程序的的意图，输入正确的指令。 实验目标对于给出的一个二进制文件，寻找正确的输入，当输入错误的时候，会提示“Boom!”意味着拆弹失败，二进制炸弹爆炸。实验总共有6个普通关卡和一个附加关卡,也就是说，总共需要破解7个输入。 前置内容材料准备下载并阅读实验指导书下载并解压缩实验材料部署g">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-07-28T15:41:39.012Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CS:APP BombLab">
<meta name="twitter:description" content="BoomLab这个实验非常有意思，需要利用csapp里面第三章学到的x86-64汇编知识以及一些逆向的技巧，来破解程序的的意图，输入正确的指令。 实验目标对于给出的一个二进制文件，寻找正确的输入，当输入错误的时候，会提示“Boom!”意味着拆弹失败，二进制炸弹爆炸。实验总共有6个普通关卡和一个附加关卡,也就是说，总共需要破解7个输入。 前置内容材料准备下载并阅读实验指导书下载并解压缩实验材料部署g">



  <link rel="alternate" href="/atom.xml" title="Yu" type="application/atom+xml">



  
  
  <link rel="canonical" href="lengyu.me/2018/08/20/CS:APP-BombLab/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  
  <title>CS:APP BombLab | Yu</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Yu</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



</div>
    </header>

    
  
  

  

  <a href="https://github.com/moooyo" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
      

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="lengyu.me/2018/08/20/CS:APP-BombLab/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Leng Yu">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yu">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">CS:APP BombLab

              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-08-20 22:45:56" itemprop="dateCreated datePublished" datetime="2018-08-20T22:45:56+08:00">2018-08-20</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-28 23:41:39" itemprop="dateModified" datetime="2019-07-28T23:41:39+08:00">2019-07-28</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/csapp/" itemprop="url" rel="index"><span itemprop="name">csapp</span></a></span>

                
                
              
            </span>
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="BoomLab"><a href="#BoomLab" class="headerlink" title="BoomLab"></a>BoomLab</h1><p>这个实验非常有意思，需要利用csapp里面第三章学到的x86-64汇编知识以及一些逆向的技巧，来破解程序的的意图，输入正确的指令。</p>
<h2 id="实验目标"><a href="#实验目标" class="headerlink" title="实验目标"></a>实验目标</h2><p>对于给出的一个二进制文件，寻找正确的输入，当输入错误的时候，会提示“Boom!”意味着拆弹失败，二进制炸弹爆炸。实验总共有6个普通关卡和一个附加关卡,也就是说，总共需要破解7个输入。</p>
<h2 id="前置内容"><a href="#前置内容" class="headerlink" title="前置内容"></a>前置内容</h2><h3 id="材料准备"><a href="#材料准备" class="headerlink" title="材料准备"></a>材料准备</h3><p>下载并阅读<a href="http://csapp.cs.cmu.edu/3e/bomblab.pdf" target="_blank" rel="noopener">实验指导书</a><br>下载并解压缩<a href="http://csapp.cs.cmu.edu/3e/bomb.tar" target="_blank" rel="noopener">实验材料</a><br>部署gcc、objdump、gdb环境。<br><del>肥宅快乐水</del></p>
<h3 id="x86-64-汇编的参数传递"><a href="#x86-64-汇编的参数传递" class="headerlink" title="x86_64 汇编的参数传递"></a>x86_64 汇编的参数传递</h3><p>编译器会按照函数参数从左到右的顺序，依次分配以下寄存器。</p>
<table>
<thead>
<tr>
<th>操作数大小</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
</tr>
</thead>
<tbody><tr>
<td>64</td>
<td>%rdi</td>
<td>%rsi</td>
<td>%rdx</td>
<td>%rcx</td>
<td>%r8</td>
<td>%r9</td>
</tr>
<tr>
<td>32</td>
<td>%edi</td>
<td>%esi</td>
<td>%edx</td>
<td>%ecx</td>
<td>%r8d</td>
<td>%r9d</td>
</tr>
<tr>
<td>16</td>
<td>%di</td>
<td>%si</td>
<td>%dx</td>
<td>%cx</td>
<td>%r8w</td>
<td>%r9w</td>
</tr>
<tr>
<td>8</td>
<td>%dil</td>
<td>%sil</td>
<td>%dl</td>
<td>%cl</td>
<td>%r8d</td>
<td>%r9b</td>
</tr>
</tbody></table>
<p>而对于一个函数的返回值，如果是非浮点数，一般是存储在%rax或者相关寄存器。</p>
<h3 id="大小端"><a href="#大小端" class="headerlink" title="大小端"></a>大小端</h3><p>x86-64处理器采用小端法存储数据，也就是数据的高位字节存储在低地址处。</p>
<h3 id="gdb调试工具"><a href="#gdb调试工具" class="headerlink" title="gdb调试工具"></a>gdb调试工具</h3><p>对于gdb调试，我列出几条这个实验用的最多的命令。</p>
<blockquote>
<p>break function 在function函数的入口处打一个断点<br>break *address 在地址address处打一个断点</p>
</blockquote>
<p>example:</p>
<blockquote>
<p>break main 在main函数入口处打一个断点<br>break *0x4c00 在地址0x4c00处打一个断点</p>
</blockquote>
<blockquote>
<p>run            开始运行<br>stepi           单步执行<br>step n          单步执行n步<br>continue        执行到下一个断点<br>info register   查看寄存器的值</p>
</blockquote>
<p>特别的，对于打印值，给出网上的资料</p>
<blockquote>
<p>x/&lt;n/f/u&gt; <addr><br>n、f、u是可选的参数，<addr>表示一个内存地址<br>1） n 是一个正整数，表示显示内存的长度，也就是说从当前地址向后显示几个地址的内容<br>2） f 表示显示的格式<br>3） u 表示将多少个字节作为一个值取出来，如果不指定的话，GDB默认是4个bytes，如果不指定的话，默认是4个bytes。当我们指定了字节长度后，GDB会从指内存定的内存地址开始，读写指定字节，并把其当作一个值取出来。<br>参数 f 的可选值：<br>x 按十六进制格式显示变量。<br>d 按十进制格式显示变量。<br>u 按十六进制格式显示无符号整型。<br>o 按八进制格式显示变量。<br>t 按二进制格式显示变量。<br>a 按十六进制格式显示变量。<br>c 按字符格式显示变量。<br>f 按浮点数格式显示变量。<br>s 按字符串格式显示变量<br>参数 u 可以用下面的字符来代替：<br>b 表示单字节<br>h 表示双字节<br>w 表示四字节<br>g 表示八字节</addr></addr></p>
</blockquote>
<p>对于此次试验，用的比较多的例子是:</p>
<blockquote>
<p>x/s 0x4ab    打印地址0x4ab处的字符串</p>
</blockquote>
<h3 id="dumpobj工具"><a href="#dumpobj工具" class="headerlink" title="dumpobj工具"></a>dumpobj工具</h3><p>objdump -t    加载二进制文件的符号表<br>objdump -d    加载二进制文件的汇编代码</p>
<h3 id="python"><a href="#python" class="headerlink" title="python"></a>python</h3><p>因为objdump之后的汇编代码里面有大量的十六进制运算，故我采用python作为一个简单的计算器，在python中可以这样进行计算。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="number">0xa</span></span><br><span class="line">b=<span class="number">0xb</span></span><br><span class="line">c=a+b</span><br><span class="line">print(<span class="string">"%#x"</span>,%c)</span><br></pre></td></tr></table></figure>

<p>上面这段代码表示将0xa和0xb加起来并且以十六进制的格式打印</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>首先采用下面两条命令保存符号表和汇编代码，方便查看。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#objdump -t bomb &amp;&gt;tag</span><br><span class="line">#objdump -d bomb &amp;&gt;asm</span><br></pre></td></tr></table></figure>

<p>接着可以打开符号表，这里面存储了该二进制文件的符号信息。我们只关心第三列，如果第三列为F，表示为function，是一个函数名。</p>
<h2 id="拆弹开始"><a href="#拆弹开始" class="headerlink" title="拆弹开始!"></a>拆弹开始!</h2><p>凭借经验，我们猜测这个东西，是以main作为入口的，<del>因为main是c语言的入口，而csapp里面都是c语言233</del>，去tag里面搜索main，果然有！那么转到asm看汇编代码，全局搜索main，共有8次记录，很轻易的我们就找到了main函数对应部分的汇编代码。是以这样的形式开头的，这也是汇编函数开头的形式:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0000000000400da0 &lt;main&gt;:</span><br><span class="line">  400da0:	53                   	push   %rbx</span><br><span class="line">  400da1:	83 ff 01             	cmp    $0x1,%edi</span><br><span class="line">  400da4:	75 10                	jne    400db6 &lt;main+0x16&gt;</span><br></pre></td></tr></table></figure>

<p>表示main函数地址为0x0000000000400da0，第一行代码是push %rbx，对应的机器码是53，该行代码地址为400da0。通看这一段代码，可以发现一大堆没啥用的部分，对于拆弹没有关系，比如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">400dc7:	e8 44 fe ff ff       	callq  400c10 &lt;fopen@plt&gt;</span><br></pre></td></tr></table></figure>

<p>表明使用了fopen函数，这个可能是用来支持直接从文件中读入而不用每次都手动输入的这个特性。往后我们看到了有</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">400e19:	e8 84 05 00 00       	callq  4013a2 &lt;initialize_bomb&gt;</span><br><span class="line">400e1e:	bf 38 23 40 00       	mov    $0x402338,%edi</span><br><span class="line">400e23:	e8 e8 fc ff ff       	callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">400e28:	bf 78 23 40 00       	mov    $0x402378,%edi</span><br><span class="line">400e2d:	e8 de fc ff ff       	callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">400e32:	e8 67 06 00 00       	callq  40149e &lt;read_line&gt;</span><br><span class="line">400e37:	48 89 c7             	mov    %rax,%rdi</span><br><span class="line">400e3a:	e8 a1 00 00 00       	callq  400ee0 &lt;phase_1&gt;</span><br><span class="line">400e3f:	e8 80 07 00 00       	callq  4015c4 &lt;phase_defused&gt;</span><br><span class="line">400e44:	bf a8 23 40 00       	mov    $0x4023a8,%edi</span><br><span class="line">400e49:	e8 c2 fc ff ff       	callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">400e4e:	e8 4b 06 00 00       	callq  40149e &lt;read_line&gt;</span><br><span class="line">400e53:	48 89 c7             	mov    %rax,%rdi</span><br><span class="line">400e56:	e8 a1 00 00 00       	callq  400efc &lt;phase_2&gt;</span><br><span class="line">400e5b:	e8 64 07 00 00       	callq  4015c4 &lt;phase_defused&gt;</span><br><span class="line">400e60:	bf ed 22 40 00       	mov    $0x4022ed,%edi</span><br><span class="line">400e65:	e8 a6 fc ff ff       	callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">400e6a:	e8 2f 06 00 00       	callq  40149e &lt;read_line&gt;</span><br><span class="line">400e6f:	48 89 c7             	mov    %rax,%rdi</span><br><span class="line">400e72:	e8 cc 00 00 00       	callq  400f43 &lt;phase_3&gt;</span><br><span class="line">400e77:	e8 48 07 00 00       	callq  4015c4 &lt;phase_defused&gt;</span><br></pre></td></tr></table></figure>

<p>先是init_bomb，感觉上可能密码藏在这里面，然后搜索跳转过去发现啥也没有<del>显然不会这么简单啊！</del>然后是两个put一个read_line接一个phase_i和phase_defuse。而如果运行bomb，会发现他的交互模式是先打印几句话，然后让你输入一句话，然后判断是否正确。于是猜测puts是没啥卵用的<del>很显然嘛，怎么可能有用</del>,read_line是用来读入的，可能在读入里面进行了判断，然后跳转过去，发现啥也没有<del>傻啊你，怎么可能会在readline里面判断</del>，于是代码核心部分应该在phase_i和phase_defused，而我们发现phase_defused是六次相同的函数，直接翻过去看这个函数，发现里面应该没有利用static或者全局变量判断第几次进入的方法，大概率密码不会藏在里面，于是乎，结果就只能在phase_i里面了！</p>
<h3 id="phase-1"><a href="#phase-1" class="headerlink" title="phase_1"></a>phase_1</h3><p>第一个关卡，正式开始我们的拆弹之旅！搜索phase_1，找到了如下代码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0000000000400ee0 &lt;phase_1&gt;:</span><br><span class="line">  400ee0:	48 83 ec 08          	sub    $0x8,%rsp</span><br><span class="line">  400ee4:	be 00 24 40 00       	mov    $0x402400,%esi</span><br><span class="line">  400ee9:	e8 4a 04 00 00       	callq  401338 &lt;strings_not_equal&gt;</span><br><span class="line">  400eee:	85 c0                	test   %eax,%eax</span><br><span class="line">  400ef0:	74 05                	je     400ef7 &lt;phase_1+0x17&gt;</span><br><span class="line">  400ef2:	e8 43 05 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  400ef7:	48 83 c4 08          	add    $0x8,%rsp</span><br><span class="line">  400efb:	c3                   	retq</span><br></pre></td></tr></table></figure>

<p>非常的短，第一关显然也不会那么难。读一下结构，先分配了8大小的栈空间，然后把一个值丢到了%esi里面，然后调用了strings_not_equal，判断返回值是否为0，如果为0就跳转到$phase_1+0x17$的位置，否则就调用explode_bomb，凭借多年的代码下毒经验，我猜测strings_not_equal和explode_bomb的函数功能不会完全与名字一致<del>自己下毒也别怀疑别人下毒啊喂</del>于是乎花费了大量时间进去找找找，结果发现自己是个sb。<br>排除了这种可能，我们重新观察这段代码，strings_not_equal显然是要比较两个字符串是否相等，这两个字符串如何传入呢？我们发现这样一段写死的代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">400ee4:	be 00 24 40 00       	mov    $0x402400,%esi</span><br></pre></td></tr></table></figure>

<p>把$0x402400的值送到%esi里面，紧接着就调用了string_not_equal!esi是函数的第二个参数，而$0x402400是一个立即数，与我们的输入无关，密码应该与0x402400有关！然后尝试去tag和asm里面全局搜索这个值，一无所获。<del>傻了吧</del>，于是乎尝试用gdb运行bomb，在phase_1打上断点，用字符串形式打印这个地址的值，有了!</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Border relations with Canada have never been better.</span><br></pre></td></tr></table></figure>

<p>这显然是一串有意义的字符串而非乱码，那就是他了！输入这串字符串，顺利过关。</p>
<h3 id="phase-2"><a href="#phase-2" class="headerlink" title="phase_2"></a>phase_2</h3><p>有了前一关的经验，直接跳到phase_2的汇编代码，这就有那么一点长了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">0000000000400efc &lt;phase_2&gt;:</span><br><span class="line">  400efc:	55                   	push   %rbp</span><br><span class="line">  400efd:	53                   	push   %rbx</span><br><span class="line">  400efe:	48 83 ec 28          	sub    $0x28,%rsp</span><br><span class="line">  400f02:	48 89 e6             	mov    %rsp,%rsi</span><br><span class="line">  400f05:	e8 52 05 00 00       	callq  40145c &lt;read_six_numbers&gt;</span><br><span class="line">  400f0a:	83 3c 24 01          	cmpl   $0x1,(%rsp)</span><br><span class="line">  400f0e:	74 20                	je     400f30 &lt;phase_2+0x34&gt;</span><br><span class="line">  400f10:	e8 25 05 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  400f15:	eb 19                	jmp    400f30 &lt;phase_2+0x34&gt;</span><br><span class="line">  400f17:	8b 43 fc             	mov    -0x4(%rbx),%eax</span><br><span class="line">  400f1a:	01 c0                	add    %eax,%eax</span><br><span class="line">  400f1c:	39 03                	cmp    %eax,(%rbx)</span><br><span class="line">  400f1e:	74 05                	je     400f25 &lt;phase_2+0x29&gt;</span><br><span class="line">  400f20:	e8 15 05 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  400f25:	48 83 c3 04          	add    $0x4,%rbx</span><br><span class="line">  400f29:	48 39 eb             	cmp    %rbp,%rbx</span><br><span class="line">  400f2c:	75 e9                	jne    400f17 &lt;phase_2+0x1b&gt;</span><br><span class="line">  400f2e:	eb 0c                	jmp    400f3c &lt;phase_2+0x40&gt;</span><br><span class="line">  400f30:	48 8d 5c 24 04       	lea    0x4(%rsp),%rbx</span><br><span class="line">  400f35:	48 8d 6c 24 18       	lea    0x18(%rsp),%rbp</span><br><span class="line">  400f3a:	eb db                	jmp    400f17 &lt;phase_2+0x1b&gt;</span><br><span class="line">  400f3c:	48 83 c4 28          	add    $0x28,%rsp</span><br><span class="line">  400f40:	5b                   	pop    %rbx</span><br><span class="line">  400f41:	5d                   	pop    %rbp</span><br><span class="line">  400f42:	c3                   	retq</span><br></pre></td></tr></table></figure>

<p>看了又看看了又看，我觉得玄机应该在read_six_numbers里面！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">000000000040145c &lt;read_six_numbers&gt;:</span><br><span class="line">  40145c:	48 83 ec 18          	sub    $0x18,%rsp</span><br><span class="line">  401460:	48 89 f2             	mov    %rsi,%rdx</span><br><span class="line">  401463:	48 8d 4e 04          	lea    0x4(%rsi),%rcx</span><br><span class="line">  401467:	48 8d 46 14          	lea    0x14(%rsi),%rax</span><br><span class="line">  40146b:	48 89 44 24 08       	mov    %rax,0x8(%rsp)</span><br><span class="line">  401470:	48 8d 46 10          	lea    0x10(%rsi),%rax</span><br><span class="line">  401474:	48 89 04 24          	mov    %rax,(%rsp)</span><br><span class="line">  401478:	4c 8d 4e 0c          	lea    0xc(%rsi),%r9</span><br><span class="line">  40147c:	4c 8d 46 08          	lea    0x8(%rsi),%r8</span><br><span class="line">  401480:	be c3 25 40 00       	mov    $0x4025c3,%esi</span><br><span class="line">  401485:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  40148a:	e8 61 f7 ff ff       	callq  400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">  40148f:	83 f8 05             	cmp    $0x5,%eax</span><br><span class="line">  401492:	7f 05                	jg     401499 &lt;read_six_numbers+0x3d&gt;</span><br><span class="line">  401494:	e8 a1 ff ff ff       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  401499:	48 83 c4 18          	add    $0x18,%rsp</span><br><span class="line">  40149d:	c3                   	retq</span><br></pre></td></tr></table></figure>

<p>根据上面的经验，我们发现了这样一串代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">401480:	be c3 25 40 00       	mov    $0x4025c3,%esi</span><br></pre></td></tr></table></figure>

<p>难道说…..胜利就在眼前？<br>结果打印出来是…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%d %d %d %d %d %d</span><br></pre></td></tr></table></figure>

<p>啊血崩，被毒瘤了。不过这也给了我们一个启示，这第二个实验要求输入六个数字，为了考察这六个数字存储的位置，尝试在phase_2的0x400f0a处打上断点，运行程序。先输入第一关的密码，然后随便输入六个数字，观察phase_2的代码，我觉得读入的结果应该放在了$rsp处，因为他通过%rsi传入了read_six_numbers函数，于是打印从$rsp开始的一段空间的值，发现六个数字是顺序存放的，也就是说read_six_numbers函数并没有下毒，比如交换位置以增大破解难度什么的<del>这证明不是所有人都像我这么无聊</del>。现在要开始正式的破解了！<br>假设我的输入是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a b c d e f</span><br></pre></td></tr></table></figure>

<p>这六个数字，那么$%rsp+(i-1)*4$是输入的第i个数字的地址。观察phase_2的代码，显示调用了读入，然后判断(%rsp)是否为1，如果为1跳转到$phase_2+0x34$，否则就调用explode_bomb，那么很明显，a必须是1。找到$phase_2+0x34$处的代码，把b的地址赋给$rbx,然后把$rsp+0x18$这个值给了%rbp，因为$4*6=24=0x18$所以这个地址是比f还要大4。然后跳转到了$phase_2+0x40$处，把%rbx-4这个地址处的值赋予eax，然后eax乘2，判断是否等于%rbx地址处的值，不等就bomb….脑内过一遍代码之后，发现了这个逻辑，也就是说a必须是1，然后b、c、d、e、f必须是前一个数字的两倍，所以显然的答案就是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 2 4 8 16 32</span><br></pre></td></tr></table></figure>

<p>过关!</p>
<h3 id="phase-3"><a href="#phase-3" class="headerlink" title="phase_3"></a>phase_3</h3><p>这一关开始我有了经验<del>并没有人在代码里面下毒</del>，找到phase_3的代码，通览一遍。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">0000000000400f43 &lt;phase_3&gt;:</span><br><span class="line">  400f43:	48 83 ec 18          	sub    $0x18,%rsp</span><br><span class="line">  400f47:	48 8d 4c 24 0c       	lea    0xc(%rsp),%rcx</span><br><span class="line">  400f4c:	48 8d 54 24 08       	lea    0x8(%rsp),%rdx</span><br><span class="line">  400f51:	be cf 25 40 00       	mov    $0x4025cf,%esi</span><br><span class="line">  400f56:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  400f5b:	e8 90 fc ff ff       	callq  400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">  400f60:	83 f8 01             	cmp    $0x1,%eax</span><br><span class="line">  400f63:	7f 05                	jg     400f6a &lt;phase_3+0x27&gt;</span><br><span class="line">  400f65:	e8 d0 04 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  400f6a:	83 7c 24 08 07       	cmpl   $0x7,0x8(%rsp)</span><br><span class="line">  400f6f:	77 3c                	ja     400fad &lt;phase_3+0x6a&gt;</span><br><span class="line">  400f71:	8b 44 24 08          	mov    0x8(%rsp),%eax</span><br><span class="line">  400f75:	ff 24 c5 70 24 40 00 	jmpq   *0x402470(,%rax,8)</span><br><span class="line">  400f7c:	b8 cf 00 00 00       	mov    $0xcf,%eax</span><br><span class="line">  400f81:	eb 3b                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400f83:	b8 c3 02 00 00       	mov    $0x2c3,%eax</span><br><span class="line">  400f88:	eb 34                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400f8a:	b8 00 01 00 00       	mov    $0x100,%eax</span><br><span class="line">  400f8f:	eb 2d                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400f91:	b8 85 01 00 00       	mov    $0x185,%eax</span><br><span class="line">  400f96:	eb 26                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400f98:	b8 ce 00 00 00       	mov    $0xce,%eax</span><br><span class="line">  400f9d:	eb 1f                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400f9f:	b8 aa 02 00 00       	mov    $0x2aa,%eax</span><br><span class="line">  400fa4:	eb 18                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400fa6:	b8 47 01 00 00       	mov    $0x147,%eax</span><br><span class="line">  400fab:	eb 11                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400fad:	e8 88 04 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  400fb2:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  400fb7:	eb 05                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400fb9:	b8 37 01 00 00       	mov    $0x137,%eax</span><br><span class="line">  400fbe:	3b 44 24 0c          	cmp    0xc(%rsp),%eax</span><br><span class="line">  400fc2:	74 05                	je     400fc9 &lt;phase_3+0x86&gt;</span><br><span class="line">  400fc4:	e8 71 04 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  400fc9:	48 83 c4 18          	add    $0x18,%rsp</span><br><span class="line">  400fcd:	c3                   	retq</span><br></pre></td></tr></table></figure>

<p>发现有一个sscanf和$0x4025cf这个魔法数被存到了esi，也就是sscanf的第二个参数，而我们知道sscanf第二个参数是format<del>怎么现在才想起来</del>。打印一下，果不其然</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%d %d</span><br></pre></td></tr></table></figure>

<p>也就是说要输入两个数，往后查找第三第四个参数%dx和%cx，发现这两个值是栈上分别偏移0x8和0xc的地址值。往后看，杜如以后先判断是否等于一，如果是就bomb，不然就跳转到0x400f6a,跳转之后比较一下第一个读入的值和7的关系，如果大于7直接Bomb，不然就继续，然后后面是一长串代码。注意这一串代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">400f75:	ff 24 c5 70 24 40 00 	jmpq   *0x402470(,%rax,8)</span><br></pre></td></tr></table></figure>

<p>虽然不知道0x402470从哪来的，但是这串代码实现了一个很简单的功能，根据%rax的值去跳转到对应的位置，类似于switch case的功能，这是很显然的，往后看正好有7个mov jmp 的组合，猜测是从0-7对应下面的每一组mov jmp组合，这个组合实现了这样一个功能，这样这么长一段代码实现了这样一个功能，也就是根据a的值来比较b的值，也就是a、b有以下的对应关系</p>
<table>
<thead>
<tr>
<th>a</th>
<th>b</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>0xcf</td>
</tr>
<tr>
<td>1</td>
<td>0x2c3</td>
</tr>
<tr>
<td>2</td>
<td>0x100</td>
</tr>
<tr>
<td>3</td>
<td>0x185</td>
</tr>
<tr>
<td>4</td>
<td>0xce</td>
</tr>
<tr>
<td>5</td>
<td>0x2aa</td>
</tr>
<tr>
<td>6</td>
<td>0x147</td>
</tr>
<tr>
<td>当一切遵从直觉之后，拆弹变得这么简单!<del>离死不远了</del>，然后测试，0正确，1…1bomb!为啥bomb了。。显然直觉出现了问题。反过头去看汇编代码，数了一下mov和jmp。发现mov + jmp是7个字节而非8个字节！这就很头疼了，需要去找一下0x402470是什么玩意儿，然后才能计算跳转的位置。找啊找找啊找并不能从代码中找到这个东西，于是尝试一下减少一下匹配，一位一位的添加，结果发现一个事实，前面的各种字符串常量，比如”%d %d”等都是用$0x4024**$指出的。。于是我们猜测这个值存放在内存中，gdb打印内存，果然</td>
<td></td>
</tr>
<tr>
<td><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/x 0x402470</span><br><span class="line">0x402470:	0x00400f7c</span><br></pre></td></tr></table></figure></td>
<td></td>
</tr>
</tbody></table>
<p><del>于是我们找到了起始地址为0x400f7c，所以跳转的地址应该是$0x400f7c+8*a$</del>谁告诉你的啊喂！作者居然在代码里下毒了！跳转地址并非顺序存放的！使用下面这条命令后，一切都揭晓了！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x/16x 0x402470</span><br></pre></td></tr></table></figure>

<p>结果为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/16x 0x402470</span><br><span class="line">0x402470:	0x00400f7c	0x00000000	0x00400fb9	0x00000000</span><br><span class="line">0x402480:	0x00400f83	0x00000000	0x00400f8a	0x00000000</span><br><span class="line">0x402490:	0x00400f91	0x00000000	0x00400f98	0x00000000</span><br><span class="line">0x4024a0:	0x00400f9f	0x00000000	0x00400fa6	0x00000000</span><br></pre></td></tr></table></figure>

<p>于是我们就可以找到正确的对应关系，这次没错了！</p>
<table>
<thead>
<tr>
<th>a</th>
<th>b</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>0xcf</td>
</tr>
<tr>
<td>1</td>
<td>0x137</td>
</tr>
<tr>
<td>2</td>
<td>0x2c3</td>
</tr>
<tr>
<td>3</td>
<td>0x100</td>
</tr>
<tr>
<td>4</td>
<td>0x185</td>
</tr>
<tr>
<td>5</td>
<td>0xce</td>
</tr>
<tr>
<td>6</td>
<td>0x2aa</td>
</tr>
<tr>
<td>7</td>
<td>0x147</td>
</tr>
</tbody></table>
<h3 id="phase-4"><a href="#phase-4" class="headerlink" title="phase_4"></a>phase_4</h3><p>进入了紧张的中场阶段！<del>我好像掌握了作者的思路!</del></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">000000000040100c &lt;phase_4&gt;:</span><br><span class="line">  40100c:	48 83 ec 18          	sub    $0x18,%rsp</span><br><span class="line">  401010:	48 8d 4c 24 0c       	lea    0xc(%rsp),%rcx</span><br><span class="line">  401015:	48 8d 54 24 08       	lea    0x8(%rsp),%rdx</span><br><span class="line">  40101a:	be cf 25 40 00       	mov    $0x4025cf,%esi</span><br><span class="line">  40101f:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  401024:	e8 c7 fb ff ff       	callq  400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">  401029:	83 f8 02             	cmp    $0x2,%eax</span><br><span class="line">  40102c:	75 07                	jne    401035 &lt;phase_4+0x29&gt;</span><br><span class="line">  40102e:	83 7c 24 08 0e       	cmpl   $0xe,0x8(%rsp)</span><br><span class="line">  401033:	76 05                	jbe    40103a &lt;phase_4+0x2e&gt;</span><br><span class="line">  401035:	e8 00 04 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  40103a:	ba 0e 00 00 00       	mov    $0xe,%edx</span><br><span class="line">  40103f:	be 00 00 00 00       	mov    $0x0,%esi</span><br><span class="line">  401044:	8b 7c 24 08          	mov    0x8(%rsp),%edi</span><br><span class="line">  401048:	e8 81 ff ff ff       	callq  400fce &lt;func4&gt;</span><br><span class="line">  40104d:	85 c0                	test   %eax,%eax</span><br><span class="line">  40104f:	75 07                	jne    401058 &lt;phase_4+0x4c&gt;</span><br><span class="line">  401051:	83 7c 24 0c 00       	cmpl   $0x0,0xc(%rsp)</span><br><span class="line">  401056:	74 05                	je     40105d &lt;phase_4+0x51&gt;</span><br><span class="line">  401058:	e8 dd 03 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  40105d:	48 83 c4 18          	add    $0x18,%rsp</span><br><span class="line">  401061:	c3                   	retq</span><br></pre></td></tr></table></figure>

<p>还是熟悉的配方!还是熟悉的参数!不过这里多了个func4,仔细观察func4的代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">0000000000400fce &lt;func4&gt;:</span><br><span class="line">  400fce:	48 83 ec 08          	sub    $0x8,%rsp</span><br><span class="line">  400fd2:	89 d0                	mov    %edx,%eax</span><br><span class="line">  400fd4:	29 f0                	sub    %esi,%eax</span><br><span class="line">  400fd6:	89 c1                	mov    %eax,%ecx</span><br><span class="line">  400fd8:	c1 e9 1f             	shr    $0x1f,%ecx</span><br><span class="line">  400fdb:	01 c8                	add    %ecx,%eax</span><br><span class="line">  400fdd:	d1 f8                	sar    %eax</span><br><span class="line">  400fdf:	8d 0c 30             	lea    (%rax,%rsi,1),%ecx</span><br><span class="line">  400fe2:	39 f9                	cmp    %edi,%ecx</span><br><span class="line">  400fe4:	7e 0c                	jle    400ff2 &lt;func4+0x24&gt;</span><br><span class="line">  400fe6:	8d 51 ff             	lea    -0x1(%rcx),%edx</span><br><span class="line">  400fe9:	e8 e0 ff ff ff       	callq  400fce &lt;func4&gt;</span><br><span class="line">  400fee:	01 c0                	add    %eax,%eax</span><br><span class="line">  400ff0:	eb 15                	jmp    401007 &lt;func4+0x39&gt;</span><br><span class="line">  400ff2:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  400ff7:	39 f9                	cmp    %edi,%ecx</span><br><span class="line">  400ff9:	7d 0c                	jge    401007 &lt;func4+0x39&gt;</span><br><span class="line">  400ffb:	8d 71 01             	lea    0x1(%rcx),%esi</span><br><span class="line">  400ffe:	e8 cb ff ff ff       	callq  400fce &lt;func4&gt;</span><br><span class="line">  401003:	8d 44 00 01          	lea    0x1(%rax,%rax,1),%eax</span><br><span class="line">  401007:	48 83 c4 08          	add    $0x8,%rsp</span><br><span class="line">  40100b:	c3                   	retq</span><br></pre></td></tr></table></figure>

<p>emmm有一点麻烦了，这好像还是递归的。因为已经知道这玩意儿有三个参数，所以尝试将他翻译成c语言代码，忽略前面调用部分，只考虑func4函数，有三个参数，分别在%rdi,%rsi,%rdx。然后分析这段函数，发现并没有保存和弹出，猜测应该是引用传参，于是写出c代码(注意sar %eax这个指令，猜测是右移一位省略了$1这个参数)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">func4</span><span class="params">(<span class="keyword">int</span> &amp;a,<span class="keyword">int</span> &amp;b,<span class="keyword">int</span> &amp;c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> x=c-b;</span><br><span class="line">  <span class="keyword">if</span>(x&lt;<span class="number">0</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    x=(x+<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  x=x/<span class="number">2</span>;</span><br><span class="line">  <span class="keyword">int</span> y=x+b;</span><br><span class="line">  <span class="keyword">if</span>(y&lt;=a)</span><br><span class="line">  &#123;</span><br><span class="line">    x=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(y&gt;=a)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">return</span> x;</span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      b=y+<span class="number">1</span>;</span><br><span class="line">      func4(a,b,c);</span><br><span class="line">      x=<span class="number">2</span>*x+<span class="number">1</span>;</span><br><span class="line">      <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    c=y<span class="number">-1</span>;</span><br><span class="line">    func4(a,b,c);</span><br><span class="line">    x=<span class="number">2</span>*x;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>直接翻译过来很难理解，做一点简单的变动，让他变得更好理解一些，事实上上面的代码等价于下面的代码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">func4</span><span class="params">(<span class="keyword">int</span> &amp;a,<span class="keyword">int</span> &amp;b,<span class="keyword">int</span> &amp;c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> x;</span><br><span class="line">  <span class="keyword">if</span>(c-b&lt;<span class="number">0</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    x=(c-b+<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">  &#125;<span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    x=(c-b)/<span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> y=x+b;</span><br><span class="line">  <span class="keyword">if</span>(y==a)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(y&lt;a)</span><br><span class="line">  &#123;</span><br><span class="line">    b=y+<span class="number">1</span>;</span><br><span class="line">    func4(a,b,c);</span><br><span class="line">    x=<span class="number">2</span>*x+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">  &#125;<span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    c=y<span class="number">-1</span>;</span><br><span class="line">    func4(a,b,c);</span><br><span class="line">    x=<span class="number">2</span>*x;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>仔细分析上面代码的这个片段</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">int</span> x;</span><br><span class="line">  <span class="keyword">if</span>(c-b&lt;<span class="number">0</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    x=(c-b+<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">  &#125;<span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    x=(c-b)/<span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> y=x+b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>猜测y的值应该是 $(b+c)/2$，那么上面这段代码可以这样理解，如果 $\frac{b+c}{2}=a$ 返回值为0，否则当 $\frac{b+c}{2}&lt;a$的时候让$b$加上1然后递归，返回值乘2倍加上1，否则就$b$减少1，返回值乘以2倍。<br>奇了怪了，这段代码到底在算些什么呢?但事实上我们不需要关心这段代码到底tmd在算啥，我们直接hack掉，找一组最直接的样例构造我们想要的结果即可！我们往回去看phase_4的代码，读入两个数ab，判断第一个数小于等于0xe，否则就爆掉，小于等于的话调用func4(0xe,0,a),然后判断返回值如果不为0，爆掉，否则看第二个数是否等于0，等于0顺利跳出。那么我们可以这样构造，先让$b=0$，再去考虑怎么让func4返回值为0，直接考虑$a=0xe/2$即可!测试一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Welcome to my fiendish little bomb. You have 6 phases with</span><br><span class="line">which to blow yourself up. Have a nice day!</span><br><span class="line">Border relations with Canada have never been better.</span><br><span class="line">Phase 1 defused. How about the next one?</span><br><span class="line">1 2 4 8 16 32</span><br><span class="line">That&apos;s number 2.  Keep going!</span><br><span class="line">0 207</span><br><span class="line">Halfway there!</span><br><span class="line">7 0</span><br><span class="line">So you got that one.  Try this one.</span><br></pre></td></tr></table></figure>

<p>通过!这个故事告诉我们，看不看得懂不重要，能构造出数据就行(逃</p>
<h3 id="phase-5"><a href="#phase-5" class="headerlink" title="phase_5"></a>phase_5</h3><p>熟练地找到对应的汇编代码，然后认真<del>xjr</del>分析一波</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">0000000000401062 &lt;phase_5&gt;:</span><br><span class="line">  401062:	53                   	push   %rbx</span><br><span class="line">  401063:	48 83 ec 20          	sub    $0x20,%rsp</span><br><span class="line">  401067:	48 89 fb             	mov    %rdi,%rbx</span><br><span class="line">  40106a:	64 48 8b 04 25 28 00 	mov    %fs:0x28,%rax</span><br><span class="line">  401071:	00 00</span><br><span class="line">  401073:	48 89 44 24 18       	mov    %rax,0x18(%rsp)</span><br><span class="line">  401078:	31 c0                	xor    %eax,%eax</span><br><span class="line">  40107a:	e8 9c 02 00 00       	callq  40131b &lt;string_length&gt;</span><br><span class="line">  40107f:	83 f8 06             	cmp    $0x6,%eax</span><br><span class="line">  401082:	74 4e                	je     4010d2 &lt;phase_5+0x70&gt;</span><br><span class="line">  401084:	e8 b1 03 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  401089:	eb 47                	jmp    4010d2 &lt;phase_5+0x70&gt;</span><br><span class="line">  40108b:	0f b6 0c 03          	movzbl (%rbx,%rax,1),%ecx</span><br><span class="line">  40108f:	88 0c 24             	mov    %cl,(%rsp)</span><br><span class="line">  401092:	48 8b 14 24          	mov    (%rsp),%rdx</span><br><span class="line">  401096:	83 e2 0f             	and    $0xf,%edx</span><br><span class="line">  401099:	0f b6 92 b0 24 40 00 	movzbl 0x4024b0(%rdx),%edx</span><br><span class="line">  4010a0:	88 54 04 10          	mov    %dl,0x10(%rsp,%rax,1)</span><br><span class="line">  4010a4:	48 83 c0 01          	add    $0x1,%rax</span><br><span class="line">  4010a8:	48 83 f8 06          	cmp    $0x6,%rax</span><br><span class="line">  4010ac:	75 dd                	jne    40108b &lt;phase_5+0x29&gt;</span><br><span class="line">  4010ae:	c6 44 24 16 00       	movb   $0x0,0x16(%rsp)</span><br><span class="line">  4010b3:	be 5e 24 40 00       	mov    $0x40245e,%esi</span><br><span class="line">  4010b8:	48 8d 7c 24 10       	lea    0x10(%rsp),%rdi</span><br><span class="line">  4010bd:	e8 76 02 00 00       	callq  401338 &lt;strings_not_equal&gt;</span><br><span class="line">  4010c2:	85 c0                	test   %eax,%eax</span><br><span class="line">  4010c4:	74 13                	je     4010d9 &lt;phase_5+0x77&gt;</span><br><span class="line">  4010c6:	e8 6f 03 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  4010cb:	0f 1f 44 00 00       	nopl   0x0(%rax,%rax,1)</span><br><span class="line">  4010d0:	eb 07                	jmp    4010d9 &lt;phase_5+0x77&gt;</span><br><span class="line">  4010d2:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  4010d7:	eb b2                	jmp    40108b &lt;phase_5+0x29&gt;</span><br><span class="line">  4010d9:	48 8b 44 24 18       	mov    0x18(%rsp),%rax</span><br><span class="line">  4010de:	64 48 33 04 25 28 00 	xor    %fs:0x28,%rax</span><br><span class="line">  4010e5:	00 00</span><br><span class="line">  4010e7:	74 05                	je     4010ee &lt;phase_5+0x8c&gt;</span><br><span class="line">  4010e9:	e8 42 fa ff ff       	callq  400b30 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">  4010ee:	48 83 c4 20          	add    $0x20,%rsp</span><br><span class="line">  4010f2:	5b                   	pop    %rbx</span><br><span class="line">  4010f3:	c3                   	retq</span><br></pre></td></tr></table></figure>

<p>看一下结构，读一个串，判断长度是不是6，然后做一堆操作，然后movzbl $0x4024b0(%rdx)，看这个地址貌似是常量区，然后又做一堆操作，判断字符串是否相等。咦，那么猜测字符串应该在$0x4024b0附近，先gdb看一下，看到这样的结果,咦，怎么结果不对呢？那么让我们跳到strings_not_equal附近，找一下比较的是哪两个字符串。第一个参数是$0x10(%rsp)，第二个参数是$0x40245e,有了!</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s 0x40245e</span><br><span class="line">0x40245e:	&quot;flyers&quot;</span><br></pre></td></tr></table></figure>

<p>刚好长度为6！，难道说….</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Welcome to my fiendish little bomb. You have 6 phases with</span><br><span class="line">which to blow yourself up. Have a nice day!</span><br><span class="line">Border relations with Canada have never been better.</span><br><span class="line">Phase 1 defused. How about the next one?</span><br><span class="line">1 2 4 8 16 32</span><br><span class="line">That&apos;s number 2.  Keep going!</span><br><span class="line">0 207</span><br><span class="line">Halfway there!</span><br><span class="line">7 0</span><br><span class="line">So you got that one.  Try this one.</span><br><span class="line">flyers</span><br><span class="line"></span><br><span class="line">BOOM!!!</span><br><span class="line">The bomb has blown up.</span><br></pre></td></tr></table></figure>

<p>果不其然<del>怎么可能这么简单啊喂</del>，但是参数应该是没有错的，那么就是在读入的串上做了点手脚！我们现在去寻找读入的字符串和$0x10(%rsp)之间的联系!输入串abcdef进去看看断点打到0x4010b8(比较字符串之前)，看看这串内存到底tmd是啥东西,结果发现目标位置变成了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aduier</span><br></pre></td></tr></table></figure>

<p>至此我们大致明白了这一关的流程，读一个串，对串做改造，看看是否等于目标串，也就是说如果改造过程为$f(x)$，那么就是要求$f(x)=”flyers”$的$x$的值，也就是 $x=f^{-1}(“flyers”)$。那么就需要知道 $f^{-1}(x)$ 的具体情况！<br>仔细考察这个过程，先读入一个串，地址为%rdi,然后一波神奇的操作之后地址处第一个字符给了%ecx,然后我们注意到了这个过程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">401099:	0f b6 92 b0 24 40 00 	movzbl 0x4024b0(%rdx),%edx</span><br><span class="line">4010a0:	88 54 04 10          	mov    %dl,0x10(%rsp,%rax,1)</span><br><span class="line">4010a4:	48 83 c0 01          	add    $0x1,%rax</span><br><span class="line">4010a8:	48 83 f8 06          	cmp    $0x6,%rax</span><br><span class="line">4010ac:	75 dd                	jne    40108b &lt;phase_5+0x29&gt;</span><br></pre></td></tr></table></figure>

<p>0x6!，做六次循环，处理过程应该就是在这里没错了!把0x4024b0(%rdx)间接寻址后的值给了相应的字符串位，%rdx又是什么呢？往上找找，发现了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">40108f:	88 0c 24             	mov    %cl,(%rsp)</span><br><span class="line">401092:	48 8b 14 24          	mov    (%rsp),%rdx</span><br><span class="line">401096:	83 e2 0f             	and    $0xf,%edx</span><br></pre></td></tr></table></figure>

<p>咦，%cx是读入的第一个字符，把第一个字符的低4位给了%rdx，高位全0，然后就到了最上面那一串寻址，这不就是switch case嘛，把整个循环部分贴出来更利于寻找答案.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">40108b:	0f b6 0c 03          	movzbl (%rbx,%rax,1),%ecx</span><br><span class="line">40108f:	88 0c 24             	mov    %cl,(%rsp)</span><br><span class="line">401092:	48 8b 14 24          	mov    (%rsp),%rdx</span><br><span class="line">401096:	83 e2 0f             	and    $0xf,%edx</span><br><span class="line">401099:	0f b6 92 b0 24 40 00 	movzbl 0x4024b0(%rdx),%edx</span><br><span class="line">4010a0:	88 54 04 10          	mov    %dl,0x10(%rsp,%rax,1)</span><br><span class="line">4010a4:	48 83 c0 01          	add    $0x1,%rax</span><br><span class="line">4010a8:	48 83 f8 06          	cmp    $0x6,%rax</span><br><span class="line">4010ac:	75 dd                	jne    40108b &lt;phase_5+0x29&gt;</span><br></pre></td></tr></table></figure>

<p>上面这段代码循环6次，也就是说把6个字符的每个字符的ascii码低4位取出来，去做一次间接寻址，送到目的地。<br>那么我们去找找0x4024b0处到底都是些什么东西!</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s 0x4024b0</span><br><span class="line">0x4024b0 &lt;array.3449&gt;:	&quot;maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?&quot;</span><br></pre></td></tr></table></figure>

<p>找到了!</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maduiersnfotvbyl</span><br></pre></td></tr></table></figure>

<p>刚好16个字符,后面恰好是一段话！也就是说这16个字符就是对应的映射表！<br>| 序号 | 字符 |<br>| —- | —- |<br>| 0    | m    |<br>| 1    | a    |<br>| 2    | d    |<br>| 3    | u    |<br>| 4    | i    |<br>| 5    | e    |<br>| 6    | r    |<br>| 7    | s    |<br>| 8    | n    |<br>| 9    | f    |<br>| 10   | o    |<br>| 11   | t    |<br>| 12   | v    |<br>| 13   | b    |<br>| 14   | y    |<br>| 15   | l    |</p>
<p>为了拼凑出flyers,我们分别需要输入的字符串分别为序号9、15、14、5、 6、 7。显然结果不唯一1!那么我们就构造一组简单的结果，想到字符a的ascii码为97,而 $97&amp;0x1=1$，也就是说a的序号为1，然后在模16的情况下依次往后增加！显然，我们可以利用字符串”ionefg”来hack掉这个炸弹!</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Good work!  On to the next...</span><br></pre></td></tr></table></figure>

<p>顺利拆弹!</p>
<h3 id="phase-6"><a href="#phase-6" class="headerlink" title="phase_6"></a>phase_6</h3><p>来到了除dlc以外的最后一关，这一关应该会有点难度。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">00000000004010f4 &lt;phase_6&gt;:</span><br><span class="line">  4010f4:	41 56                	push   %r14</span><br><span class="line">  4010f6:	41 55                	push   %r13</span><br><span class="line">  4010f8:	41 54                	push   %r12</span><br><span class="line">  4010fa:	55                   	push   %rbp</span><br><span class="line">  4010fb:	53                   	push   %rbx</span><br><span class="line">  4010fc:	48 83 ec 50          	sub    $0x50,%rsp</span><br><span class="line">  401100:	49 89 e5             	mov    %rsp,%r13</span><br><span class="line">  401103:	48 89 e6             	mov    %rsp,%rsi</span><br><span class="line">  401106:	e8 51 03 00 00       	callq  40145c &lt;read_six_numbers&gt;</span><br><span class="line">  40110b:	49 89 e6             	mov    %rsp,%r14</span><br><span class="line">  40110e:	41 bc 00 00 00 00    	mov    $0x0,%r12d</span><br><span class="line">  401114:	4c 89 ed             	mov    %r13,%rbp</span><br><span class="line">  401117:	41 8b 45 00          	mov    0x0(%r13),%eax</span><br><span class="line">  40111b:	83 e8 01             	sub    $0x1,%eax</span><br><span class="line">  40111e:	83 f8 05             	cmp    $0x5,%eax</span><br><span class="line">  401121:	76 05                	jbe    401128 &lt;phase_6+0x34&gt;</span><br><span class="line">  401123:	e8 12 03 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  401128:	41 83 c4 01          	add    $0x1,%r12d</span><br><span class="line">  40112c:	41 83 fc 06          	cmp    $0x6,%r12d</span><br><span class="line">  401130:	74 21                	je     401153 &lt;phase_6+0x5f&gt;</span><br><span class="line">  401132:	44 89 e3             	mov    %r12d,%ebx</span><br><span class="line">  401135:	48 63 c3             	movslq %ebx,%rax</span><br><span class="line">  401138:	8b 04 84             	mov    (%rsp,%rax,4),%eax</span><br><span class="line">  40113b:	39 45 00             	cmp    %eax,0x0(%rbp)</span><br><span class="line">  40113e:	75 05                	jne    401145 &lt;phase_6+0x51&gt;</span><br><span class="line">  401140:	e8 f5 02 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  401145:	83 c3 01             	add    $0x1,%ebx</span><br><span class="line">  401148:	83 fb 05             	cmp    $0x5,%ebx</span><br><span class="line">  40114b:	7e e8                	jle    401135 &lt;phase_6+0x41&gt;</span><br><span class="line">  40114d:	49 83 c5 04          	add    $0x4,%r13</span><br><span class="line">  401151:	eb c1                	jmp    401114 &lt;phase_6+0x20&gt;</span><br><span class="line">  401153:	48 8d 74 24 18       	lea    0x18(%rsp),%rsi</span><br><span class="line">  401158:	4c 89 f0             	mov    %r14,%rax</span><br><span class="line">  40115b:	b9 07 00 00 00       	mov    $0x7,%ecx</span><br><span class="line">  401160:	89 ca                	mov    %ecx,%edx</span><br><span class="line">  401162:	2b 10                	sub    (%rax),%edx</span><br><span class="line">  401164:	89 10                	mov    %edx,(%rax)</span><br><span class="line">  401166:	48 83 c0 04          	add    $0x4,%rax</span><br><span class="line">  40116a:	48 39 f0             	cmp    %rsi,%rax</span><br><span class="line">  40116d:	75 f1                	jne    401160 &lt;phase_6+0x6c&gt;</span><br><span class="line">  40116f:	be 00 00 00 00       	mov    $0x0,%esi</span><br><span class="line">  401174:	eb 21                	jmp    401197 &lt;phase_6+0xa3&gt;</span><br><span class="line">  401176:	48 8b 52 08          	mov    0x8(%rdx),%rdx</span><br><span class="line">  40117a:	83 c0 01             	add    $0x1,%eax</span><br><span class="line">  40117d:	39 c8                	cmp    %ecx,%eax</span><br><span class="line">  40117f:	75 f5                	jne    401176 &lt;phase_6+0x82&gt;</span><br><span class="line">  401181:	eb 05                	jmp    401188 &lt;phase_6+0x94&gt;</span><br><span class="line">  401183:	ba d0 32 60 00       	mov    $0x6032d0,%edx</span><br><span class="line">  401188:	48 89 54 74 20       	mov    %rdx,0x20(%rsp,%rsi,2)</span><br><span class="line">  40118d:	48 83 c6 04          	add    $0x4,%rsi</span><br><span class="line">  401191:	48 83 fe 18          	cmp    $0x18,%rsi</span><br><span class="line">  401195:	74 14                	je     4011ab &lt;phase_6+0xb7&gt;</span><br><span class="line">  401197:	8b 0c 34             	mov    (%rsp,%rsi,1),%ecx</span><br><span class="line">  40119a:	83 f9 01             	cmp    $0x1,%ecx</span><br><span class="line">  40119d:	7e e4                	jle    401183 &lt;phase_6+0x8f&gt;</span><br><span class="line">  40119f:	b8 01 00 00 00       	mov    $0x1,%eax</span><br><span class="line">  4011a4:	ba d0 32 60 00       	mov    $0x6032d0,%edx</span><br><span class="line">  4011a9:	eb cb                	jmp    401176 &lt;phase_6+0x82&gt;</span><br><span class="line">  4011ab:	48 8b 5c 24 20       	mov    0x20(%rsp),%rbx</span><br><span class="line">  4011b0:	48 8d 44 24 28       	lea    0x28(%rsp),%rax</span><br><span class="line">  4011b5:	48 8d 74 24 50       	lea    0x50(%rsp),%rsi</span><br><span class="line">  4011ba:	48 89 d9             	mov    %rbx,%rcx</span><br><span class="line">  4011bd:	48 8b 10             	mov    (%rax),%rdx</span><br><span class="line">  4011c0:	48 89 51 08          	mov    %rdx,0x8(%rcx)</span><br><span class="line">  4011c4:	48 83 c0 08          	add    $0x8,%rax</span><br><span class="line">  4011c8:	48 39 f0             	cmp    %rsi,%rax</span><br><span class="line">  4011cb:	74 05                	je     4011d2 &lt;phase_6+0xde&gt;</span><br><span class="line">  4011cd:	48 89 d1             	mov    %rdx,%rcx</span><br><span class="line">  4011d0:	eb eb                	jmp    4011bd &lt;phase_6+0xc9&gt;</span><br><span class="line">  4011d2:	48 c7 42 08 00 00 00 	movq   $0x0,0x8(%rdx)</span><br><span class="line">  4011d9:	00</span><br><span class="line">  4011da:	bd 05 00 00 00       	mov    $0x5,%ebp</span><br><span class="line">  4011df:	48 8b 43 08          	mov    0x8(%rbx),%rax</span><br><span class="line">  4011e3:	8b 00                	mov    (%rax),%eax</span><br><span class="line">  4011e5:	39 03                	cmp    %eax,(%rbx)</span><br><span class="line">  4011e7:	7d 05                	jge    4011ee &lt;phase_6+0xfa&gt;</span><br><span class="line">  4011e9:	e8 4c 02 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  4011ee:	48 8b 5b 08          	mov    0x8(%rbx),%rbx</span><br><span class="line">  4011f2:	83 ed 01             	sub    $0x1,%ebp</span><br><span class="line">  4011f5:	75 e8                	jne    4011df &lt;phase_6+0xeb&gt;</span><br><span class="line">  4011f7:	48 83 c4 50          	add    $0x50,%rsp</span><br><span class="line">  4011fb:	5b                   	pop    %rbx</span><br><span class="line">  4011fc:	5d                   	pop    %rbp</span><br><span class="line">  4011fd:	41 5c                	pop    %r12</span><br><span class="line">  4011ff:	41 5d                	pop    %r13</span><br><span class="line">  401201:	41 5e                	pop    %r14</span><br><span class="line">  401203:	c3                   	retq</span><br></pre></td></tr></table></figure>

<p>这一关我们看到了熟悉的read_six_number!因为前面已经探讨过了这个函数的功能<del>没有人在这段代码下毒</del>，于是我们就不再进去仔细看这段代码的逻辑。这次我们速战速决，不去分析read之前的代码了，直接上断点到read之后，然后看一下寄存器，找到对应的值存在哪，输入1 2 3 4 5 6，然后</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/20d $rsp</span><br><span class="line">0x7fffffffdc70:	1	2	3	4</span><br><span class="line">0x7fffffffdc80:	5	6	0	0</span><br><span class="line">0x7fffffffdc90:	-8752	32767	0	0</span><br><span class="line">0x7fffffffdca0:	0	0	4199372	0</span><br><span class="line">0x7fffffffdcb0:	6306064	0	6306064	0</span><br></pre></td></tr></table></figure>

<p>显然，六个数字完整的摆在了栈顶。假设分别为abcdef,接着把第一个值给了r14,r12,rbp,eax，然后判断eax-1和5的大小，比他大就爆掉，所以 $a&lt;=5$,然后判%r12和6的关系，如果等于6跳转，否则不跳转，这里显然 $a=5$ 是一个极其特殊的情况，为了hack掉这个炸弹，我们忽略细节往他想要的答案处构造，直接让$a=5$，跟着跳转过去。把7减去 $a$,也就是 $%edx=7-5=2$,又把%edx送给了a,一连串操作之后a变成了2。然后的然后发现了重点！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">401160:	89 ca                	mov    %ecx,%edx</span><br><span class="line">401162:	2b 10                	sub    (%rax),%edx</span><br><span class="line">401164:	89 10                	mov    %edx,(%rax)</span><br><span class="line">401166:	48 83 c0 04          	add    $0x4,%rax</span><br><span class="line">40116a:	48 39 f0             	cmp    %rsi,%rax</span><br><span class="line">40116d:	75 f1                	jne    401160 &lt;phase_6+0x6c&gt;</span><br></pre></td></tr></table></figure>

<p>之前的操作中让rsi变成了偏移0x18的位置，也就是第六个数字之后的位置，那么这一段代码的意图就很显然了，把六个数字都做一遍处理，用7减去然后再放回去。<br>但这都不是重点，我们往后看，%r12d为1往下执行，到了后面用了一行间接寻址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">401138:	8b 04 84             	mov    (%rsp,%rax,4),%eax</span><br></pre></td></tr></table></figure>

<p>把第二个数取了出来，发现和%rbp做了比较，%rbp往前找发现值为栈顶也就是间接寻址到第一个数字,必须不相等，否则爆掉！然后执行了上面我们所说那段循环。并且我们在此处找到了一串循环</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">401114:	4c 89 ed             	mov    %r13,%rbp</span><br><span class="line">401117:	41 8b 45 00          	mov    0x0(%r13),%eax</span><br><span class="line">40111b:	83 e8 01             	sub    $0x1,%eax</span><br><span class="line">40111e:	83 f8 05             	cmp    $0x5,%eax</span><br><span class="line">401121:	76 05                	jbe    401128 &lt;phase_6+0x34&gt;</span><br><span class="line">401123:	e8 12 03 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">401128:	41 83 c4 01          	add    $0x1,%r12d</span><br><span class="line">40112c:	41 83 fc 06          	cmp    $0x6,%r12d</span><br><span class="line">401130:	74 21                	je     401153 &lt;phase_6+0x5f&gt;</span><br><span class="line">401132:	44 89 e3             	mov    %r12d,%ebx</span><br><span class="line">401135:	48 63 c3             	movslq %ebx,%rax</span><br><span class="line">401138:	8b 04 84             	mov    (%rsp,%rax,4),%eax</span><br><span class="line">40113b:	39 45 00             	cmp    %eax,0x0(%rbp)</span><br><span class="line">40113e:	75 05                	jne    401145 &lt;phase_6+0x51&gt;</span><br><span class="line">401140:	e8 f5 02 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">401145:	83 c3 01             	add    $0x1,%ebx</span><br><span class="line">401148:	83 fb 05             	cmp    $0x5,%ebx</span><br><span class="line">40114b:	7e e8                	jle    401135 &lt;phase_6+0x41&gt;</span><br><span class="line">40114d:	49 83 c5 04          	add    $0x4,%r13</span><br><span class="line">401151:	eb c1                	jmp    401114 &lt;phase_6+0x20&gt;</span><br></pre></td></tr></table></figure>

<p>这段代码检查所有值是否有相等且是否有大于6的，如果有就爆掉。如果没有爆掉就执行上面讨论的那段循环，进行值的变化。<br>然后紧接着又来了一大段的循环<del>内心崩溃，就不能简单点吗？</del></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">401176:	48 8b 52 08          	mov    0x8(%rdx),%rdx</span><br><span class="line">40117a:	83 c0 01             	add    $0x1,%eax</span><br><span class="line">40117d:	39 c8                	cmp    %ecx,%eax</span><br><span class="line">40117f:	75 f5                	jne    401176 &lt;phase_6+0x82&gt;</span><br><span class="line">401181:	eb 05                	jmp    401188 &lt;phase_6+0x94&gt;</span><br><span class="line">401183:	ba d0 32 60 00       	mov    $0x6032d0,%edx</span><br><span class="line">401188:	48 89 54 74 20       	mov    %rdx,0x20(%rsp,%rsi,2)</span><br><span class="line">40118d:	48 83 c6 04          	add    $0x4,%rsi</span><br><span class="line">401191:	48 83 fe 18          	cmp    $0x18,%rsi</span><br><span class="line">401195:	74 14                	je     4011ab &lt;phase_6+0xb7&gt;</span><br><span class="line">401197:	8b 0c 34             	mov    (%rsp,%rsi,1),%ecx</span><br><span class="line">40119a:	83 f9 01             	cmp    $0x1,%ecx</span><br><span class="line">40119d:	7e e4                	jle    401183 &lt;phase_6+0x8f&gt;</span><br><span class="line">40119f:	b8 01 00 00 00       	mov    $0x1,%eax</span><br><span class="line">4011a4:	ba d0 32 60 00       	mov    $0x6032d0,%edx</span><br><span class="line">4011a9:	eb cb                	jmp    401176 &lt;phase_6+0x82&gt;</span><br></pre></td></tr></table></figure>

<p>猜测这应该是一段while循环，跳出条件可能是处理完了所有的数字跳到0x4011ab(很像jump to middle的翻译方式)。然后我们看到rdx和一串地址0x6032d0有关，打印一下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/40d 0x6032d0</span><br><span class="line">0x6032d0 &lt;node1&gt;:	76	1	0	0	1	0	0	0</span><br><span class="line">0x6032d8 &lt;node1+8&gt;:	-32	50	96	0	0	0	0	0</span><br><span class="line">0x6032e0 &lt;node2&gt;:	-88	0	0	0	2	0	0	0</span><br><span class="line">0x6032e8 &lt;node2+8&gt;:	-16	50	96	0	0	0	0	0</span><br><span class="line">0x6032f0 &lt;node3&gt;:	-100	3	0	0	3	0	0	0</span><br></pre></td></tr></table></figure>

<p>node，这难道是一个结构体？多打印一点出来试试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/100 0x6032d0</span><br><span class="line">0x6032d0 &lt;node1&gt;:	76	1	0	0	1	0	0	0</span><br><span class="line">0x6032d8 &lt;node1+8&gt;:	-32	50	96	0	0	0	0	0</span><br><span class="line">0x6032e0 &lt;node2&gt;:	-88	0	0	0	2	0	0	0</span><br><span class="line">0x6032e8 &lt;node2+8&gt;:	-16	50	96	0	0	0	0	0</span><br><span class="line">0x6032f0 &lt;node3&gt;:	-100	3	0	0	3	0	0	0</span><br><span class="line">0x6032f8 &lt;node3+8&gt;:	0	51	96	0	0	0	0	0</span><br><span class="line">0x603300 &lt;node4&gt;:	-77	2	0	0	4	0	0	0</span><br><span class="line">0x603308 &lt;node4+8&gt;:	16	51	96	0	0	0	0	0</span><br><span class="line">0x603310 &lt;node5&gt;:	-35	1	0	0	5	0	0	0</span><br><span class="line">0x603318 &lt;node5+8&gt;:	32	51	96	0	0	0	0	0</span><br><span class="line">0x603320 &lt;node6&gt;:	-69	1	0	0	6	0	0	0</span><br><span class="line">0x603328 &lt;node6+8&gt;:	0	0	0	0	0	0	0</span><br><span class="line">0x603330:	0	0	0	0</span><br></pre></td></tr></table></figure>

<p>咦，我们读入六个数字，这里也只标记到6，会不会有什么阴谋呢？反正最终一定和这串地址有关，那我们仔细观察一下。感觉不太明显，换16进制试试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">0x6032d0 &lt;node1&gt;:	0x4c	0x01	0x00	0x00	0x01	0x00	0x00	0x00</span><br><span class="line">0x6032d8 &lt;node1+8&gt;:	0xe0	0x32	0x60	0x00	0x00	0x00	0x00	0x00</span><br><span class="line">0x6032e0 &lt;node2&gt;:	0xa8	0x00	0x00	0x00	0x02	0x00	0x00	0x00</span><br><span class="line">0x6032e8 &lt;node2+8&gt;:	0xf0	0x32	0x60	0x00	0x00	0x00	0x00	0x00</span><br><span class="line">0x6032f0 &lt;node3&gt;:	0x9c	0x03	0x00	0x00	0x03	0x00	0x00	0x00</span><br><span class="line">0x6032f8 &lt;node3+8&gt;:	0x00	0x33	0x60	0x00	0x00	0x00	0x00	0x00</span><br><span class="line">0x603300 &lt;node4&gt;:	0xb3	0x02	0x00	0x00	0x04	0x00	0x00	0x00</span><br><span class="line">0x603308 &lt;node4+8&gt;:	0x10	0x33	0x60	0x00	0x00	0x00	0x00	0x00</span><br><span class="line">0x603310 &lt;node5&gt;:	0xdd	0x01	0x00	0x00	0x05	0x00	0x00	0x00</span><br><span class="line">0x603318 &lt;node5+8&gt;:	0x20	0x33	0x60	0x00	0x00	0x00	0x00	0x00</span><br><span class="line">0x603320 &lt;node6&gt;:	0xbb	0x01	0x00	0x00	0x06	0x00	0x00	0x00</span><br><span class="line">0x603328 &lt;node6+8&gt;:	0x00	0x00	0x00	0x00	0x00	0x00	0x00	0x00</span><br></pre></td></tr></table></figure>

<p>还是没什么思路，去看看代码，发现有这么一串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">401176:	48 8b 52 08          	mov    0x8(%rdx),%rdx</span><br></pre></td></tr></table></figure>

<p>好像和偏移地址0x8有关，仔细看一下所有的node+8的位置，考虑到x86采用小端法，那么就要倒过来才能看明白。观察第一个，倒过来看值是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x00000000006032e0</span><br></pre></td></tr></table></figure>

<p>这个地址不就正好在这一段里面吗！这是个指针，恰好也是8字节！而第六个指向了0x0，在c语言里面代表NULL，难道说这是个链表？而我们知道read_six_num读入六个int型数据，应该是四字节，也就是说最后对比大概率也是四字节，再加上之前我们分析出读入的数据应该在1-6之间，观察一下 我们猜测node+4的位置存放了我们的数据。我们从NULL入手倒着去找他们之间的连接关系，发现答案可能是:$6&lt;-5&lt;-4&lt;-3&lt;-2&lt;-1$的倒叙。但总感觉哪里不太对劲。这个顺序太特殊了，试一下，果然爆掉了。现在还剩前面四个字节没有使用，苦思冥想，还是想不出来。看了下别人的解法<del>实在是不想读那么长的汇编</del>，发现这是一个结构体，类似</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></span><br><span class="line">  <span class="keyword">int</span> value;</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line">  node *next;</span><br><span class="line">&#125;node;</span><br></pre></td></tr></table></figure>

<p>前四个字节应该是对应的值，后四个字节是对应的序号，对这六个节点进行排序之后，按输出序号(注意小端法的特点)。<br><del>于是结果为:3 4 5 6 1 2</del><br>boom!傻了吧！网传教程早已经过时了，自力更生吧!<br>于是我们想到，之前一长串代码使得所有的值都变成了$7-x$，那么会不会结果在这上面改造呢？尝试性输入4 3 2 1 6 5</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Good work!  On to the next...</span><br><span class="line">4 3 2 1 6 5</span><br><span class="line">Congratulations! You&apos;ve defused the bomb!</span><br></pre></td></tr></table></figure>

<p>果然！顺利结束,差点以为要去看那一长串汇编(逃。</p>
<h3 id="DLC"><a href="#DLC" class="headerlink" title="DLC"></a>DLC</h3><h4 id="被”欺骗”的单身狗"><a href="#被”欺骗”的单身狗" class="headerlink" title="被”欺骗”的单身狗"></a>被”欺骗”的单身狗</h4><p>8月23日，凌晨五点，天好热，电费好贵(电费*3)，作为一个上进的单身狗，我沉浸在代码的世界里，<del>顺利</del>解决掉了六个问题，程序对我表示了祝贺。</p>
<blockquote>
<p>Congratulations! You’ve defused the bomb!</p>
</blockquote>
<p>突然，我发现我被”歧视”了，或许因为我不是“付费”玩家的缘故，我没有找到实验指导书上告诉我的一个隐藏关卡，程序就直接结束了…为了探寻“充值入口”，我打开了符号表，搜索phase，找到了这个函数secret_phase。可是入口在哪呢？直接全局搜索，发现他出现在了phase_defused里面。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">00000000004015c4 &lt;phase_defused&gt;:</span><br><span class="line">  4015c4:	48 83 ec 78          	sub    $0x78,%rsp</span><br><span class="line">  4015c8:	64 48 8b 04 25 28 00 	mov    %fs:0x28,%rax</span><br><span class="line">  4015cf:	00 00</span><br><span class="line">  4015d1:	48 89 44 24 68       	mov    %rax,0x68(%rsp)</span><br><span class="line">  4015d6:	31 c0                	xor    %eax,%eax</span><br><span class="line">  4015d8:	83 3d 81 21 20 00 06 	cmpl   $0x6,0x202181(%rip)     # 603760 &lt;num_input_strings&gt;</span><br><span class="line">  4015df:	75 5e                	jne    40163f &lt;phase_defused+0x7b&gt;</span><br><span class="line">  4015e1:	4c 8d 44 24 10       	lea    0x10(%rsp),%r8</span><br><span class="line">  4015e6:	48 8d 4c 24 0c       	lea    0xc(%rsp),%rcx</span><br><span class="line">  4015eb:	48 8d 54 24 08       	lea    0x8(%rsp),%rdx</span><br><span class="line">  4015f0:	be 19 26 40 00       	mov    $0x402619,%esi</span><br><span class="line">  4015f5:	bf 70 38 60 00       	mov    $0x603870,%edi</span><br><span class="line">  4015fa:	e8 f1 f5 ff ff       	callq  400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">  4015ff:	83 f8 03             	cmp    $0x3,%eax</span><br><span class="line">  401602:	75 31                	jne    401635 &lt;phase_defused+0x71&gt;</span><br><span class="line">  401604:	be 22 26 40 00       	mov    $0x402622,%esi</span><br><span class="line">  401609:	48 8d 7c 24 10       	lea    0x10(%rsp),%rdi</span><br><span class="line">  40160e:	e8 25 fd ff ff       	callq  401338 &lt;strings_not_equal&gt;</span><br><span class="line">  401613:	85 c0                	test   %eax,%eax</span><br><span class="line">  401615:	75 1e                	jne    401635 &lt;phase_defused+0x71&gt;</span><br><span class="line">  401617:	bf f8 24 40 00       	mov    $0x4024f8,%edi</span><br><span class="line">  40161c:	e8 ef f4 ff ff       	callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  401621:	bf 20 25 40 00       	mov    $0x402520,%edi</span><br><span class="line">  401626:	e8 e5 f4 ff ff       	callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  40162b:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  401630:	e8 0d fc ff ff       	callq  401242 &lt;secret_phase&gt;</span><br><span class="line">  401635:	bf 58 25 40 00       	mov    $0x402558,%edi</span><br><span class="line">  40163a:	e8 d1 f4 ff ff       	callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  40163f:	48 8b 44 24 68       	mov    0x68(%rsp),%rax</span><br><span class="line">  401644:	64 48 33 04 25 28 00 	xor    %fs:0x28,%rax</span><br><span class="line">  40164b:	00 00</span><br><span class="line">  40164d:	74 05                	je     401654 &lt;phase_defused+0x90&gt;</span><br><span class="line">  40164f:	e8 dc f4 ff ff       	callq  400b30 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">  401654:	48 83 c4 78          	add    $0x78,%rsp</span><br></pre></td></tr></table></figure>

<p>名称叫拆弹，里面确大有玄机。而这个函数出现在了每一个关卡的后面，说明隐藏关一定有一个特殊的唤醒机制。而这个函数里面居然出现了sscanf和strings_not_equal，不符合正常操作的逻辑，也就是说，这里面对一个我们读入的字符串进行了判断。按照惯例，我们去找比较的两个字符串，找到了这两行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">401604:	be 22 26 40 00       	mov    $0x402622,%esi</span><br><span class="line">401609:	48 8d 7c 24 10       	lea    0x10(%rsp),%rdi</span><br></pre></td></tr></table></figure>

<p>也就是说在比较一个栈上的字符串和一个常量区的字符串，打印0x402622，看看是什么东西.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s 0x402622</span><br><span class="line">0x402622:	&quot;DrEvil&quot;</span><br></pre></td></tr></table></figure>

<p>果然，是一串有意义的字符串。可是，要怎么触发这个机制呢？经过测试，发现只有当到达最后一关，也就是第六关的时候，会走到一个奇怪的位置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">4015fa:	e8 f1 f5 ff ff       	callq  400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">4015ff:	83 f8 03             	cmp    $0x3,%eax</span><br><span class="line">401602:	75 31                	jne    401635 &lt;phase_defused+0x71&gt;</span><br></pre></td></tr></table></figure>

<p>而跳转过去的位置恰好是秘密关卡的后面，所以如果要进入秘密关卡，就不能跳转！看到判断sscanf的返回值是否等于3，心里已经有了点数。再往后，看到了一个字符串比较，于是打上断点，看看都发生了什么</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s 0x402619</span><br><span class="line">0x402619:	&quot;%d %d %s&quot;</span><br><span class="line">(gdb) x/s 0x603870</span><br><span class="line">0x603870 &lt;input_strings+240&gt;:	&quot;7 0&quot;</span><br></pre></td></tr></table></figure>

<p>打印前面的常量，发现了一个奇怪的串和一个奇怪的位置。%d%d%s应该是读入两个数字和一个字符串，从0x603870处读入，而0x603870是”7 0”，是我们在第二关输入的答案！尝试在第二关后面加一点东西hack一下，果然这样使得sscanf成功读入了三个数据。加什么字符串呢？往后看看到了字符串比较，那就是他了！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Welcome to my fiendish little bomb. You have 6 phases with</span><br><span class="line">which to blow yourself up. Have a nice day!</span><br><span class="line">Border relations with Canada have never been better.</span><br><span class="line">Phase 1 defused. How about the next one?</span><br><span class="line">1 2 4 8 16 32</span><br><span class="line">That&apos;s number 2.  Keep going!</span><br><span class="line">0 207</span><br><span class="line">Halfway there!</span><br><span class="line">7 0 DrEvil</span><br><span class="line">So you got that one.  Try this one.</span><br><span class="line">ionefg</span><br><span class="line">Good work!  On to the next...</span><br><span class="line">4 3 2 1 6 5</span><br><span class="line">Curses, you&apos;ve found the secret phase!</span><br><span class="line">But finding it and solving it are quite different...</span><br></pre></td></tr></table></figure>

<p>果然触发了DLC剧情!</p>
<h4 id="进入正题"><a href="#进入正题" class="headerlink" title="进入正题"></a>进入正题</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">0000000000401242 &lt;secret_phase&gt;:</span><br><span class="line">  401242:	53                   	push   %rbx</span><br><span class="line">  401243:	e8 56 02 00 00       	callq  40149e &lt;read_line&gt;</span><br><span class="line">  401248:	ba 0a 00 00 00       	mov    $0xa,%edx</span><br><span class="line">  40124d:	be 00 00 00 00       	mov    $0x0,%esi</span><br><span class="line">  401252:	48 89 c7             	mov    %rax,%rdi</span><br><span class="line">  401255:	e8 76 f9 ff ff       	callq  400bd0 &lt;strtol@plt&gt;</span><br><span class="line">  40125a:	48 89 c3             	mov    %rax,%rbx</span><br><span class="line">  40125d:	8d 40 ff             	lea    -0x1(%rax),%eax</span><br><span class="line">  401260:	3d e8 03 00 00       	cmp    $0x3e8,%eax</span><br><span class="line">  401265:	76 05                	jbe    40126c &lt;secret_phase+0x2a&gt;</span><br><span class="line">  401267:	e8 ce 01 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  40126c:	89 de                	mov    %ebx,%esi</span><br><span class="line">  40126e:	bf f0 30 60 00       	mov    $0x6030f0,%edi</span><br><span class="line">  401273:	e8 8c ff ff ff       	callq  401204 &lt;fun7&gt;</span><br><span class="line">  401278:	83 f8 02             	cmp    $0x2,%eax</span><br><span class="line">  40127b:	74 05                	je     401282 &lt;secret_phase+0x40&gt;</span><br><span class="line">  40127d:	e8 b8 01 00 00       	callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  401282:	bf 38 24 40 00       	mov    $0x402438,%edi</span><br><span class="line">  401287:	e8 84 f8 ff ff       	callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  40128c:	e8 33 03 00 00       	callq  4015c4 &lt;phase_defused&gt;</span><br><span class="line">  401291:	5b                   	pop    %rbx</span><br></pre></td></tr></table></figure>

<p>看到几串非常奇怪的代码,先进行简单的分析.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">401248:	ba 0a 00 00 00       	mov    $0xa,%edx</span><br><span class="line">40124d:	be 00 00 00 00       	mov    $0x0,%esi</span><br><span class="line">401252:	48 89 c7             	mov    %rax,%rdi</span><br><span class="line">401255:	e8 76 f9 ff ff       	callq  400bd0 &lt;strtol@plt&gt;</span><br><span class="line">40125a:	48 89 c3             	mov    %rax,%rbx</span><br><span class="line">40125d:	8d 40 ff             	lea    -0x1(%rax),%eax</span><br><span class="line">401260:	3d e8 03 00 00       	cmp    $0x3e8,%eax</span><br><span class="line">401265:	76 05                	jbe    40126c &lt;secret_phase+0x2a&gt;</span><br></pre></td></tr></table></figure>

<p>调用了strtol，这个函数需要三个参数，第一个为字符串，第二个为endptr,第三个为int型，表示base，然后把字符串转化为长整形数。也就是说这个地方把一串数字字符串转化成了一个整数然后与0x3e8进行了比较。而$0x3e8=1000$。再仔细看传入的参数，第三个表示base的参数为$0xa=10$,也就是10进制。<br>非常短的代码，根据前面的分析，读一行之后进行进制转换，然后判断减１是否小于等于0x3e8,如果是，就把这个数和一串地址传入fun7，然后判断返回值是否等于２．</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">0000000000401204 &lt;fun7&gt;:</span><br><span class="line">  401204:	48 83 ec 08          	sub    $0x8,%rsp</span><br><span class="line">  401208:	48 85 ff             	test   %rdi,%rdi</span><br><span class="line">  40120b:	74 2b                	je     401238 &lt;fun7+0x34&gt;</span><br><span class="line">  40120d:	8b 17                	mov    (%rdi),%edx</span><br><span class="line">  40120f:	39 f2                	cmp    %esi,%edx</span><br><span class="line">  401211:	7e 0d                	jle    401220 &lt;fun7+0x1c&gt;</span><br><span class="line">  401213:	48 8b 7f 08          	mov    0x8(%rdi),%rdi</span><br><span class="line">  401217:	e8 e8 ff ff ff       	callq  401204 &lt;fun7&gt;</span><br><span class="line">  40121c:	01 c0                	add    %eax,%eax</span><br><span class="line">  40121e:	eb 1d                	jmp    40123d &lt;fun7+0x39&gt;</span><br><span class="line">  401220:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  401225:	39 f2                	cmp    %esi,%edx</span><br><span class="line">  401227:	74 14                	je     40123d &lt;fun7+0x39&gt;</span><br><span class="line">  401229:	48 8b 7f 10          	mov    0x10(%rdi),%rdi</span><br><span class="line">  40122d:	e8 d2 ff ff ff       	callq  401204 &lt;fun7&gt;</span><br><span class="line">  401232:	8d 44 00 01          	lea    0x1(%rax,%rax,1),%eax</span><br><span class="line">  401236:	eb 05                	jmp    40123d &lt;fun7+0x39&gt;</span><br><span class="line">  401238:	b8 ff ff ff ff       	mov    $0xffffffff,%eax</span><br><span class="line">  40123d:	48 83 c4 08          	add    $0x8,%rsp</span><br><span class="line">  401241:	c3                   	retq</span><br></pre></td></tr></table></figure>

<p>fun7中我们可以发现，这玩意儿tmd还是一个递归的东西。于是我们尝试将他翻译成c语言</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fun7</span><span class="params">(<span class="keyword">int</span>* a,<span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(a==<span class="literal">NULL</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">int</span> y=*a;</span><br><span class="line">  <span class="keyword">if</span>(y==b)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(y&lt;b)</span><br><span class="line">  &#123;</span><br><span class="line">    a=*(a+<span class="number">0x10</span>);</span><br><span class="line">    <span class="keyword">int</span> q=fun7(a,b);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>*q+<span class="number">1</span>;</span><br><span class="line">  &#125;<span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    a=*(a+<span class="number">0x8</span>);</span><br><span class="line">    <span class="keyword">int</span> q=fun7(a,b);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>*q;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>仔细理一下思路，如果a是空指针返回－１，否则比较a处的值和b的关系，相等返回0，其他情况在往后走8字节或者16字节然后<strong>取出当前的值作为地址</strong>。而我们要的结果是２，只需要构造一个返回值为２的情况就行了!打印a初始值表示的地址附近的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/128d 0x6030f0</span><br><span class="line">0x6030f0 &lt;n1&gt;:	36	0	6304016	0</span><br><span class="line">0x603100 &lt;n1+16&gt;:	6304048	0	0	0</span><br><span class="line">0x603110 &lt;n21&gt;:	8	0	6304144	0</span><br><span class="line">0x603120 &lt;n21+16&gt;:	6304080	0	0	0</span><br><span class="line">0x603130 &lt;n22&gt;:	50	0	6304112	0</span><br><span class="line">0x603140 &lt;n22+16&gt;:	6304176	0	0	0</span><br><span class="line">0x603150 &lt;n32&gt;:	22	0	6304368	0</span><br><span class="line">0x603160 &lt;n32+16&gt;:	6304304	0	0	0</span><br><span class="line">0x603170 &lt;n33&gt;:	45	0	6304208	0</span><br><span class="line">0x603180 &lt;n33+16&gt;:	6304400	0	0	0</span><br><span class="line">0x603190 &lt;n31&gt;:	6	0	6304240	0</span><br><span class="line">0x6031a0 &lt;n31+16&gt;:	6304336	0	0	0</span><br><span class="line">0x6031b0 &lt;n34&gt;:	107	0	6304272	0</span><br><span class="line">0x6031c0 &lt;n34+16&gt;:	6304432	0	0	0</span><br><span class="line">0x6031d0 &lt;n45&gt;:	40	0	0	0</span><br><span class="line">0x6031e0 &lt;n45+16&gt;:	0	0	0	0</span><br><span class="line">0x6031f0 &lt;n41&gt;:	1	0	0	0</span><br><span class="line">0x603200 &lt;n41+16&gt;:	0	0	0	0</span><br><span class="line">0x603210 &lt;n47&gt;:	99	0	0	0</span><br><span class="line">0x603220 &lt;n47+16&gt;:	0	0	0	0</span><br><span class="line">0x603230 &lt;n44&gt;:	35	0	0	0</span><br><span class="line">0x603240 &lt;n44+16&gt;:	0	0	0	0</span><br><span class="line">0x603250 &lt;n42&gt;:	7	0	0	0</span><br><span class="line">0x603260 &lt;n42+16&gt;:	0	0	0	0</span><br><span class="line">0x603270 &lt;n43&gt;:	20	0	0	0</span><br><span class="line">0x603280 &lt;n43+16&gt;:	0	0	0	0</span><br><span class="line">0x603290 &lt;n46&gt;:	47	0	0	0</span><br><span class="line">0x6032a0 &lt;n46+16&gt;:	0	0	0	0</span><br><span class="line">0x6032b0 &lt;n48&gt;:	1001	0	0	0</span><br><span class="line">0x6032c0 &lt;n48+16&gt;:	0	0	0	0</span><br></pre></td></tr></table></figure>

<p>首先断定一定是$y=b$才能跳出递归，其次$b\leq 1001$总是成立,而且因为每一次递归结果都会至少翻一倍，所以猜测结果一定在不远处。那么我们只考虑8的倍数的地址，一个一个看过去看到22的时候发现，22的时候返回值刚好是2!</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Welcome to my fiendish little bomb. You have 6 phases with</span><br><span class="line">which to blow yourself up. Have a nice day!</span><br><span class="line">Border relations with Canada have never been better.</span><br><span class="line">Phase 1 defused. How about the next one?</span><br><span class="line">1 2 4 8 16 32</span><br><span class="line">That&apos;s number 2.  Keep going!</span><br><span class="line">0 207</span><br><span class="line">Halfway there!</span><br><span class="line">7 0 DrEvil</span><br><span class="line">So you got that one.  Try this one.</span><br><span class="line">ionefg</span><br><span class="line">Good work!  On to the next...</span><br><span class="line">4 3 2 1 6 5</span><br><span class="line">Curses, you&apos;ve found the secret phase!</span><br><span class="line">But finding it and solving it are quite different...</span><br><span class="line">22</span><br><span class="line">Wow! You&apos;ve defused the secret stage!</span><br><span class="line">Congratulations! You&apos;ve defused the bomb!</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这个实验非常有意思，花了我两天时间来完成，一开始耐性还不错，直接读汇编去找答案，但是到第六关真的崩溃了，这么长一段汇编，读了快一个小时，分析出输入的数字必须是1-6，然后找到了一个莫名奇妙的地址之后实在是心态爆炸，于是去参考了<a href="https://wdxtub.com/2016/04/16/thick-csapp-lab-2/" target="_blank" rel="noopener">不周山Lab解析</a>，这也是本次实验最大的遗憾之处<del>最大的黑点</del>，没有完全独立自主的完成。假期也快要结束，csapp之旅却还刚刚开始!</p>

      
    </div>

    

    
      
    

    
    
    

    

    
      
    
    

    
      <div>
        




  



<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Yu.Leng</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    
    <a href="/lengyu.me/2018/08/20/CS:APP-BombLab/" title="CS:APP BombLab">lengyu.me/2018/08/20/CS:APP-BombLab/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        
          
        
        <div class="post-tags">
          
            <a href="/tags/csapp/" rel="tag"># csapp</a>
          
            <a href="/tags/工程向/" rel="tag"># 工程向</a>
          
            <a href="/tags/计算机体系/" rel="tag"># 计算机体系</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/08/19/CS:APP-第三章-数据对齐/" rel="next" title="CS:APP 第三章-数据对齐">
                <i class="fa fa-chevron-left"></i> CS:APP 第三章-数据对齐
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/09/05/CS:APP-AttackLab/" rel="prev" title="CS:APP AttackLab">
                CS:APP AttackLab <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>

  </div>


          </div>
          
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  
  <p class="site-author-name" itemprop="name">Leng Yu</p>
  <div class="site-description motion-element" itemprop="description"></div>
</div>


  <nav class="site-state motion-element">
    
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    

    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        
        
          
        
          
        
          
        
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    

    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>



  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>





  <div class="links-of-author motion-element">
    
      <span class="links-of-author-item">
      
      
      
        
      
        <a href="https://github.com/moooyo" title="GitHub &rarr; https://github.com/moooyo" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i></a>
      </span>
    
      <span class="links-of-author-item">
      
      
      
        
      
        <a href="mailto:lengyuchn@qq.com" title="E-Mail &rarr; mailto:lengyuchn@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i></a>
      </span>
    
  </div>



  <div class="cc-license motion-element" itemprop="license">
  
  
    
  
  
  
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>





          
          
        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#BoomLab"><span class="nav-number">1.</span> <span class="nav-text">BoomLab</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#实验目标"><span class="nav-number">1.1.</span> <span class="nav-text">实验目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#前置内容"><span class="nav-number">1.2.</span> <span class="nav-text">前置内容</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#材料准备"><span class="nav-number">1.2.1.</span> <span class="nav-text">材料准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#x86-64-汇编的参数传递"><span class="nav-number">1.2.2.</span> <span class="nav-text">x86_64 汇编的参数传递</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#大小端"><span class="nav-number">1.2.3.</span> <span class="nav-text">大小端</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#gdb调试工具"><span class="nav-number">1.2.4.</span> <span class="nav-text">gdb调试工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dumpobj工具"><span class="nav-number">1.2.5.</span> <span class="nav-text">dumpobj工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#python"><span class="nav-number">1.2.6.</span> <span class="nav-text">python</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#准备工作"><span class="nav-number">1.3.</span> <span class="nav-text">准备工作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#拆弹开始"><span class="nav-number">1.4.</span> <span class="nav-text">拆弹开始!</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#phase-1"><span class="nav-number">1.4.1.</span> <span class="nav-text">phase_1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#phase-2"><span class="nav-number">1.4.2.</span> <span class="nav-text">phase_2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#phase-3"><span class="nav-number">1.4.3.</span> <span class="nav-text">phase_3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#phase-4"><span class="nav-number">1.4.4.</span> <span class="nav-text">phase_4</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#phase-5"><span class="nav-number">1.4.5.</span> <span class="nav-text">phase_5</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#phase-6"><span class="nav-number">1.4.6.</span> <span class="nav-text">phase_6</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DLC"><span class="nav-number">1.4.7.</span> <span class="nav-text">DLC</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#被”欺骗”的单身狗"><span class="nav-number">1.4.7.1.</span> <span class="nav-text">被”欺骗”的单身狗</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#进入正题"><span class="nav-number">1.4.7.2.</span> <span class="nav-text">进入正题</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">1.5.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">leng yu</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a></div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    

  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
















  
  









  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>




  <script src="/js/utils.js?v=7.2.0"></script>

  <script src="/js/motion.js?v=7.2.0"></script>



  
  


  <script src="/js/affix.js?v=7.2.0"></script>

  <script src="/js/schemes/pisces.js?v=7.2.0"></script>




  
  <script src="/js/scrollspy.js?v=7.2.0"></script>
<script src="/js/post-details.js?v=7.2.0"></script>



  <script src="/js/next-boot.js?v=7.2.0"></script>

  

  

  


  
  

  
  

  
    
      <script type="text/x-mathjax-config">
  

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script>
<script src="//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    
  































  

</body>
</html>
